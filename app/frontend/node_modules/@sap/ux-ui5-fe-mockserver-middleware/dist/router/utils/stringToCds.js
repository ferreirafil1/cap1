"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.compileCDS = void 0;
var cds_compiler_1 = require("@sap/cds-compiler");
var commonContent = "type Language : Association to sap.common.Languages;\ntype Currency : Association to sap.common.Currencies;\ntype Country : Association to sap.common.Countries;\n\n/**\n * Entities to serve the reuse types with extensible code lists\n * including built-in support for value lists in Fiori.\n */\ncontext sap.common {\n  entity Languages : CodeList {\n    key code : String(14) @(title : '{i18n>LanguageCode}');\n    //> length=14 is to accommodate values like these:\n    // en_US_x_saptrc - (1Q) used as a technical SAP language code\n    // en_US_x_sappsd - (2Q) used as a technical SAP language code\n  }\n\n  entity Countries : CodeList {\n    key code : String(3) @(title : '{i18n>CountryCode}');\n  }\n\n  entity Currencies : CodeList {\n    key code   : String(3) @(title : '{i18n>CurrencyCode}');\n        symbol : String(5) @(title : '{i18n>CurrencySymbol}');\n  }\n\n  aspect CodeList @(\n    cds.autoexpose,\n    cds.persistence.skip : 'if-unused'\n  ) {\n    name  : localized String(255)  @title : '{i18n>Name}';\n    descr : localized String(1000) @title : '{i18n>Description}';\n  }\n}\n\n\n/*\n * Aspect for entities with canonical universal IDs.\n */\naspect cuid {\n  key ID : UUID; //> automatically filled in\n}\n\n/*\n * Aspect to capture changes by user and name.\n */\naspect managed {\n  createdAt  : Timestamp @cds.on.insert : $now;\n  createdBy  : User      @cds.on.insert : $user;\n  modifiedAt : Timestamp @cds.on.insert : $now  @cds.on.update : $now;\n  modifiedBy : User      @cds.on.insert : $user @cds.on.update : $user;\n}\n\n/*\n * Aspects for entities with temporal data.\n */\naspect temporal {\n  validFrom : Timestamp @cds.valid.from;\n  validTo   : Timestamp @cds.valid.to;\n}\n\n\n/**\n * Canonical user ID\n */\ntype User : String(255);\n\n\n//---------------------------------------------------------------------------\n// Annotations for Fiori UIs...\n\nannotate sap.common.CodeList with @UI.Identification : [{Value:name}];\nannotate sap.common.CodeList with @cds.odata.valuelist;\n\nannotate managed with {\n  createdAt  @UI.HiddenFilter;\n  createdBy  @UI.HiddenFilter;\n  modifiedAt @UI.HiddenFilter;\n  modifiedBy @UI.HiddenFilter;\n}\n\nannotate managed with {\n  createdAt  @Core.Immutable;\n  createdBy  @Core.Immutable;\n}\n\nannotate sap.common.Countries  with { code @Common.Text:name; }\nannotate sap.common.Currencies with { code @Common.Text:name; }\nannotate sap.common.Languages  with { code @Common.Text:name; }\n\n\n//---------------------------------------------------------------------------\n// Common Annotations...\n\nannotate Language with @(\n  title       : '{i18n>Language}',\n  description : '{i18n>LanguageCode.Description}'\n);\n\nannotate Currency with @(\n  title       : '{i18n>Currency}',\n  description : '{i18n>CurrencyCode.Description}'\n);\n\nannotate Country with @(\n  title       : '{i18n>Country}',\n  description : '{i18n>CountryCode.Description}'\n);\n\nannotate User with @(\n  title       : '{i18n>UserID}',\n  description : '{i18n>UserID.Description}'\n);\n\nannotate managed with {\n  createdAt  @title : '{i18n>CreatedAt}';\n  createdBy  @title : '{i18n>CreatedBy}';\n  modifiedAt @title : '{i18n>ChangedAt}';\n  modifiedBy @title : '{i18n>ChangedBy}';\n}\n\n\n//---------------------------------------------------------------------------\n// Temporary Workarounds...\n\n// REVISIT: change @odata.on... to @cds.on...\n// REVISIT: @cds.on... should automatically result in @readonly @Core.Computed\n\nannotate managed with {\n  modifiedAt @readonly  @odata.on.update : #now;\n  createdAt  @readonly  @odata.on.insert : #now;\n  createdBy  @readonly  @odata.on.insert : #user;\n  modifiedBy @readonly  @odata.on.update : #user;\n}\n\n//---------------------------------------------------------------------------\n";
var commonCSN = cds_compiler_1.compileSources({ 'string.cds': commonContent }, {});
exports.compileCDS = function (cdsString, serviceName) {
    if (serviceName === void 0) { serviceName = 'sap.ux.TestService'; }
    var csn = cds_compiler_1.compileSources({ 'string.cds': cdsString }, {});
    csn.definitions = Object.assign(commonCSN.definitions, csn.definitions);
    var csnModel = cds_compiler_1.compactModel(csn);
    var edmxContent = cds_compiler_1.to.edmx(csnModel, { service: serviceName });
    return edmxContent;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaW5nVG9DZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcm91dGVyL3V0aWxzL3N0cmluZ1RvQ2RzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGtEQUFxRTtBQUVyRSxJQUFNLGFBQWEsR0FBRyw2dEhBdUlyQixDQUFDO0FBRUYsSUFBTSxTQUFTLEdBQUcsNkJBQWMsQ0FBQyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUV6RCxRQUFBLFVBQVUsR0FBRyxVQUFDLFNBQWlCLEVBQUUsV0FBa0M7SUFBbEMsNEJBQUEsRUFBQSxrQ0FBa0M7SUFDNUUsSUFBTSxHQUFHLEdBQUcsNkJBQWMsQ0FBQyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1RCxHQUFHLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDeEUsSUFBTSxRQUFRLEdBQUcsMkJBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNuQyxJQUFNLFdBQVcsR0FBRyxpQkFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUNoRSxPQUFPLFdBQVcsQ0FBQztBQUN2QixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb21wYWN0TW9kZWwsIGNvbXBpbGVTb3VyY2VzLCB0byB9IGZyb20gJ0BzYXAvY2RzLWNvbXBpbGVyJztcblxuY29uc3QgY29tbW9uQ29udGVudCA9IGB0eXBlIExhbmd1YWdlIDogQXNzb2NpYXRpb24gdG8gc2FwLmNvbW1vbi5MYW5ndWFnZXM7XG50eXBlIEN1cnJlbmN5IDogQXNzb2NpYXRpb24gdG8gc2FwLmNvbW1vbi5DdXJyZW5jaWVzO1xudHlwZSBDb3VudHJ5IDogQXNzb2NpYXRpb24gdG8gc2FwLmNvbW1vbi5Db3VudHJpZXM7XG5cbi8qKlxuICogRW50aXRpZXMgdG8gc2VydmUgdGhlIHJldXNlIHR5cGVzIHdpdGggZXh0ZW5zaWJsZSBjb2RlIGxpc3RzXG4gKiBpbmNsdWRpbmcgYnVpbHQtaW4gc3VwcG9ydCBmb3IgdmFsdWUgbGlzdHMgaW4gRmlvcmkuXG4gKi9cbmNvbnRleHQgc2FwLmNvbW1vbiB7XG4gIGVudGl0eSBMYW5ndWFnZXMgOiBDb2RlTGlzdCB7XG4gICAga2V5IGNvZGUgOiBTdHJpbmcoMTQpIEAodGl0bGUgOiAne2kxOG4+TGFuZ3VhZ2VDb2RlfScpO1xuICAgIC8vPiBsZW5ndGg9MTQgaXMgdG8gYWNjb21tb2RhdGUgdmFsdWVzIGxpa2UgdGhlc2U6XG4gICAgLy8gZW5fVVNfeF9zYXB0cmMgLSAoMVEpIHVzZWQgYXMgYSB0ZWNobmljYWwgU0FQIGxhbmd1YWdlIGNvZGVcbiAgICAvLyBlbl9VU194X3NhcHBzZCAtICgyUSkgdXNlZCBhcyBhIHRlY2huaWNhbCBTQVAgbGFuZ3VhZ2UgY29kZVxuICB9XG5cbiAgZW50aXR5IENvdW50cmllcyA6IENvZGVMaXN0IHtcbiAgICBrZXkgY29kZSA6IFN0cmluZygzKSBAKHRpdGxlIDogJ3tpMThuPkNvdW50cnlDb2RlfScpO1xuICB9XG5cbiAgZW50aXR5IEN1cnJlbmNpZXMgOiBDb2RlTGlzdCB7XG4gICAga2V5IGNvZGUgICA6IFN0cmluZygzKSBAKHRpdGxlIDogJ3tpMThuPkN1cnJlbmN5Q29kZX0nKTtcbiAgICAgICAgc3ltYm9sIDogU3RyaW5nKDUpIEAodGl0bGUgOiAne2kxOG4+Q3VycmVuY3lTeW1ib2x9Jyk7XG4gIH1cblxuICBhc3BlY3QgQ29kZUxpc3QgQChcbiAgICBjZHMuYXV0b2V4cG9zZSxcbiAgICBjZHMucGVyc2lzdGVuY2Uuc2tpcCA6ICdpZi11bnVzZWQnXG4gICkge1xuICAgIG5hbWUgIDogbG9jYWxpemVkIFN0cmluZygyNTUpICBAdGl0bGUgOiAne2kxOG4+TmFtZX0nO1xuICAgIGRlc2NyIDogbG9jYWxpemVkIFN0cmluZygxMDAwKSBAdGl0bGUgOiAne2kxOG4+RGVzY3JpcHRpb259JztcbiAgfVxufVxuXG5cbi8qXG4gKiBBc3BlY3QgZm9yIGVudGl0aWVzIHdpdGggY2Fub25pY2FsIHVuaXZlcnNhbCBJRHMuXG4gKi9cbmFzcGVjdCBjdWlkIHtcbiAga2V5IElEIDogVVVJRDsgLy8+IGF1dG9tYXRpY2FsbHkgZmlsbGVkIGluXG59XG5cbi8qXG4gKiBBc3BlY3QgdG8gY2FwdHVyZSBjaGFuZ2VzIGJ5IHVzZXIgYW5kIG5hbWUuXG4gKi9cbmFzcGVjdCBtYW5hZ2VkIHtcbiAgY3JlYXRlZEF0ICA6IFRpbWVzdGFtcCBAY2RzLm9uLmluc2VydCA6ICRub3c7XG4gIGNyZWF0ZWRCeSAgOiBVc2VyICAgICAgQGNkcy5vbi5pbnNlcnQgOiAkdXNlcjtcbiAgbW9kaWZpZWRBdCA6IFRpbWVzdGFtcCBAY2RzLm9uLmluc2VydCA6ICRub3cgIEBjZHMub24udXBkYXRlIDogJG5vdztcbiAgbW9kaWZpZWRCeSA6IFVzZXIgICAgICBAY2RzLm9uLmluc2VydCA6ICR1c2VyIEBjZHMub24udXBkYXRlIDogJHVzZXI7XG59XG5cbi8qXG4gKiBBc3BlY3RzIGZvciBlbnRpdGllcyB3aXRoIHRlbXBvcmFsIGRhdGEuXG4gKi9cbmFzcGVjdCB0ZW1wb3JhbCB7XG4gIHZhbGlkRnJvbSA6IFRpbWVzdGFtcCBAY2RzLnZhbGlkLmZyb207XG4gIHZhbGlkVG8gICA6IFRpbWVzdGFtcCBAY2RzLnZhbGlkLnRvO1xufVxuXG5cbi8qKlxuICogQ2Fub25pY2FsIHVzZXIgSURcbiAqL1xudHlwZSBVc2VyIDogU3RyaW5nKDI1NSk7XG5cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEFubm90YXRpb25zIGZvciBGaW9yaSBVSXMuLi5cblxuYW5ub3RhdGUgc2FwLmNvbW1vbi5Db2RlTGlzdCB3aXRoIEBVSS5JZGVudGlmaWNhdGlvbiA6IFt7VmFsdWU6bmFtZX1dO1xuYW5ub3RhdGUgc2FwLmNvbW1vbi5Db2RlTGlzdCB3aXRoIEBjZHMub2RhdGEudmFsdWVsaXN0O1xuXG5hbm5vdGF0ZSBtYW5hZ2VkIHdpdGgge1xuICBjcmVhdGVkQXQgIEBVSS5IaWRkZW5GaWx0ZXI7XG4gIGNyZWF0ZWRCeSAgQFVJLkhpZGRlbkZpbHRlcjtcbiAgbW9kaWZpZWRBdCBAVUkuSGlkZGVuRmlsdGVyO1xuICBtb2RpZmllZEJ5IEBVSS5IaWRkZW5GaWx0ZXI7XG59XG5cbmFubm90YXRlIG1hbmFnZWQgd2l0aCB7XG4gIGNyZWF0ZWRBdCAgQENvcmUuSW1tdXRhYmxlO1xuICBjcmVhdGVkQnkgIEBDb3JlLkltbXV0YWJsZTtcbn1cblxuYW5ub3RhdGUgc2FwLmNvbW1vbi5Db3VudHJpZXMgIHdpdGggeyBjb2RlIEBDb21tb24uVGV4dDpuYW1lOyB9XG5hbm5vdGF0ZSBzYXAuY29tbW9uLkN1cnJlbmNpZXMgd2l0aCB7IGNvZGUgQENvbW1vbi5UZXh0Om5hbWU7IH1cbmFubm90YXRlIHNhcC5jb21tb24uTGFuZ3VhZ2VzICB3aXRoIHsgY29kZSBAQ29tbW9uLlRleHQ6bmFtZTsgfVxuXG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBDb21tb24gQW5ub3RhdGlvbnMuLi5cblxuYW5ub3RhdGUgTGFuZ3VhZ2Ugd2l0aCBAKFxuICB0aXRsZSAgICAgICA6ICd7aTE4bj5MYW5ndWFnZX0nLFxuICBkZXNjcmlwdGlvbiA6ICd7aTE4bj5MYW5ndWFnZUNvZGUuRGVzY3JpcHRpb259J1xuKTtcblxuYW5ub3RhdGUgQ3VycmVuY3kgd2l0aCBAKFxuICB0aXRsZSAgICAgICA6ICd7aTE4bj5DdXJyZW5jeX0nLFxuICBkZXNjcmlwdGlvbiA6ICd7aTE4bj5DdXJyZW5jeUNvZGUuRGVzY3JpcHRpb259J1xuKTtcblxuYW5ub3RhdGUgQ291bnRyeSB3aXRoIEAoXG4gIHRpdGxlICAgICAgIDogJ3tpMThuPkNvdW50cnl9JyxcbiAgZGVzY3JpcHRpb24gOiAne2kxOG4+Q291bnRyeUNvZGUuRGVzY3JpcHRpb259J1xuKTtcblxuYW5ub3RhdGUgVXNlciB3aXRoIEAoXG4gIHRpdGxlICAgICAgIDogJ3tpMThuPlVzZXJJRH0nLFxuICBkZXNjcmlwdGlvbiA6ICd7aTE4bj5Vc2VySUQuRGVzY3JpcHRpb259J1xuKTtcblxuYW5ub3RhdGUgbWFuYWdlZCB3aXRoIHtcbiAgY3JlYXRlZEF0ICBAdGl0bGUgOiAne2kxOG4+Q3JlYXRlZEF0fSc7XG4gIGNyZWF0ZWRCeSAgQHRpdGxlIDogJ3tpMThuPkNyZWF0ZWRCeX0nO1xuICBtb2RpZmllZEF0IEB0aXRsZSA6ICd7aTE4bj5DaGFuZ2VkQXR9JztcbiAgbW9kaWZpZWRCeSBAdGl0bGUgOiAne2kxOG4+Q2hhbmdlZEJ5fSc7XG59XG5cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFRlbXBvcmFyeSBXb3JrYXJvdW5kcy4uLlxuXG4vLyBSRVZJU0lUOiBjaGFuZ2UgQG9kYXRhLm9uLi4uIHRvIEBjZHMub24uLi5cbi8vIFJFVklTSVQ6IEBjZHMub24uLi4gc2hvdWxkIGF1dG9tYXRpY2FsbHkgcmVzdWx0IGluIEByZWFkb25seSBAQ29yZS5Db21wdXRlZFxuXG5hbm5vdGF0ZSBtYW5hZ2VkIHdpdGgge1xuICBtb2RpZmllZEF0IEByZWFkb25seSAgQG9kYXRhLm9uLnVwZGF0ZSA6ICNub3c7XG4gIGNyZWF0ZWRBdCAgQHJlYWRvbmx5ICBAb2RhdGEub24uaW5zZXJ0IDogI25vdztcbiAgY3JlYXRlZEJ5ICBAcmVhZG9ubHkgIEBvZGF0YS5vbi5pbnNlcnQgOiAjdXNlcjtcbiAgbW9kaWZpZWRCeSBAcmVhZG9ubHkgIEBvZGF0YS5vbi51cGRhdGUgOiAjdXNlcjtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmA7XG5cbmNvbnN0IGNvbW1vbkNTTiA9IGNvbXBpbGVTb3VyY2VzKHsgJ3N0cmluZy5jZHMnOiBjb21tb25Db250ZW50IH0sIHt9KTtcblxuZXhwb3J0IGNvbnN0IGNvbXBpbGVDRFMgPSAoY2RzU3RyaW5nOiBzdHJpbmcsIHNlcnZpY2VOYW1lID0gJ3NhcC51eC5UZXN0U2VydmljZScpID0+IHtcbiAgICBjb25zdCBjc24gPSBjb21waWxlU291cmNlcyh7ICdzdHJpbmcuY2RzJzogY2RzU3RyaW5nIH0sIHt9KTtcbiAgICBjc24uZGVmaW5pdGlvbnMgPSBPYmplY3QuYXNzaWduKGNvbW1vbkNTTi5kZWZpbml0aW9ucywgY3NuLmRlZmluaXRpb25zKTtcbiAgICBjb25zdCBjc25Nb2RlbCA9IGNvbXBhY3RNb2RlbChjc24pO1xuICAgIGNvbnN0IGVkbXhDb250ZW50ID0gdG8uZWRteChjc25Nb2RlbCwgeyBzZXJ2aWNlOiBzZXJ2aWNlTmFtZSB9KTtcbiAgICByZXR1cm4gZWRteENvbnRlbnQ7XG59O1xuIl19